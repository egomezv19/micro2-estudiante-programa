service: estudiante-service

provider:
  name: aws
  runtime: python3.9  # Define el runtime de Python
  region: us-east-1
  iam:
    role: arn:aws:iam::353553552499:role/LabRole  # ARN del rol IAM que especificaste

functions:
  buscarEstudiante:
    handler: handler.lambda_handler
    environment:
      DYNAMODB_TABLE: Estudiante  # Nombre de la tabla DynamoDB en variable de entorno
    events:
      - http:
          path: estudiantes/buscar
          method: get
          cors: true
          request:
            parameters:
              querystrings:
                ID-Estudiante: false
                Email: false

  eliminarEstudiante:
    handler: handler.eliminar_estudiante  # Define el manejador de eliminar
    environment:
      DYNAMODB_TABLE: Estudiante
    events:
      - http:
          path: estudiantes/eliminar
          method: delete
          cors: true
          request:
            parameters:
              querystrings:
                ID-Estudiante: true
                DNI: true

  modificarEstudiante:
    handler: handler.modificar_estudiante  # Define el manejador de modificar
    environment:
      DYNAMODB_TABLE: Estudiante
    events:
      - http:
          path: estudiantes/modificar
          method: put
          cors: true

resources:
  Resources:
    EstudianteTable:
      Type: AWS::DynamoDB::Table
      Properties:
        TableName: Estudiante
        BillingMode: PAY_PER_REQUEST  # Configuraci√≥n para modo bajo demanda
        AttributeDefinitions:
          - AttributeName: ID-Estudiante
            AttributeType: S
          - AttributeName: DNI
            AttributeType: S
          - AttributeName: Email
            AttributeType: S
          - AttributeName: Nro_Tel
            AttributeType: S
        KeySchema:
          - AttributeName: ID-Estudiante
            KeyType: HASH
          - AttributeName: DNI
            KeyType: RANGE
        LocalSecondaryIndexes:
          - IndexName: EmailIndex
            KeySchema:
              - AttributeName: ID-Estudiante
                KeyType: HASH
              - AttributeName: Email
                KeyType: RANGE
            Projection:
              ProjectionType: ALL
          - IndexName: NroTelIndex
            KeySchema:
              - AttributeName: ID-Estudiante
                KeyType: HASH
              - AttributeName: Nro_Tel
                KeyType: RANGE
            Projection:
              ProjectionType: ALL
        GlobalSecondaryIndexes:
          - IndexName: EmailGSI
            KeySchema:
              - AttributeName: Email
                KeyType: HASH
            Projection:
              ProjectionType: ALL
          - IndexName: DNIGSI
            KeySchema:
              - AttributeName: DNI
                KeyType: HASH
            Projection:
              ProjectionType: ALL
